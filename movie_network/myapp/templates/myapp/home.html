{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenBird Home</title>
    <link rel="stylesheet" href="{% static 'myapp/home.css' %}">
</head>
<body>
    <!-- Top bar -->
    <header class="topbar">
        <div class="brand">GreenBird</div>
        <nav class="top-actions">
            <form method="POST" action="{% url 'myapp:logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn small">Logout</button>
            </form>
        </nav>
    </header>

    <main class="container">
        <!-- Left menu -->
        <aside class="left">
            <ul class="menu">
                <li class="active">Home</li>
                <li>Explore</li>
                <li>Notifications</li>
                <li>Messages</li>
            </ul>
        </aside>

        <!-- Feed -->
        <section class="feed">

            <!-- Composer -->
            <div class="composer card">
                <form id="composeForm" method="POST">
                    {% csrf_token %}
                    <textarea id="composeInput" name="compose-post" maxlength="280" placeholder="What's happening?" rows="3"></textarea>
                    <div class="composer-row">
                        <div class="composer-actions">
                            <span id="charCount">280</span>
                        </div>
                        <div>
                            <button type="submit" name="submit" value="post" class="btn">Post</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="community-dropdown card">
            <form method="POST" id="communityForm">
                {% csrf_token %}
                <input type="hidden" name="submit" value="select-community">
                <select name="community" id="communitySelect">
                    <option value="" disabled selected>Select a community</option>
                    {% for community in communities %}
                        <option value="{{ community.id }}">{{ community.name }}</option>
                    {% endfor %}
                </select>
                <button name="submit" value="select-community">Select</button>
            </form>
          </div>

            <!-- Timeline --> 
            <div id="timeline">
                {% if posts %}
                    {% for post in posts %}
                        <article class="tweet card">
                            <div class="tweet-left">
                                <div class="t-avatar">{{ post.poster.username|slice:":2"|upper }}</div>
                            </div>
                            <div class="tweet-body">
                                <div class="tweet-head">
                                    <span class="t-name">{{ post.poster.username }}</span>
                                    <span class="t-handle">@{{ post.poster.username }}</span>
                                    <span class="t-time">Â· {{ post.created_at|timesince }} ago</span>
                                </div>
                                <div class="t-text">{{ post.content }}</div>
                            </div>
                        </article>
                    {% endfor %}
                {% else %}
                    <p class="muted">No posts yet. Select a community or compose one above!</p>
                {% endif %}
            </div>
        </section>

        <!-- Right sidebar -->
        <aside class="right">
            <div class="trends card">
                <h3>Trends for you</h3>
                <ul>
                    <li>#GreenAI</li>
                    <li>#OpenSource</li>
                    <li>#Design</li>
                </ul>
            </div>
        </aside>
    </main>

    <script src="{% static 'myapp/home.js' %}"></script>
</body>
</html>
